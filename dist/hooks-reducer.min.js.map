{"version":3,"file":"hooks-reducer.min.js","sources":["../node_modules/@babel/runtime/helpers/esm/extends.js","../src/provider.js","../src/connect.js","../src/mergeReducer.js"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import React, {useReducer} from 'react';\n\nexport const HooksContext = React.createContext(null);\n\nconst initState = Object.create(null);\nconst initAction = Object.create(null);\nlet initStore;\n\nexport default function HooksProvider(props) {\n\n    if (!initStore)\n        initStore = props.hooksStore(initState, initAction);\n\n    const [state, dispatch] = useReducer(\n        props.hooksStore,\n        initStore\n    );\n\n    const _children = props.children;\n    const _props = {};\n\n    for (const key in props) {\n        if (props.hasOwnProperty(key)) {\n            if (key !== 'children') {\n                _props[key] = props[key];\n            }\n        }\n    }\n\n    return React.createElement(\n        HooksContext.Provider,\n        {value: [state, dispatch]},\n        React.cloneElement(_children, _props)\n    )\n}\n\n","import React, {useContext} from 'react';\nimport {HooksContext} from './provider';\n\nlet _state, _dispatch;\n\nconst dispatchHandler = (actionResult) => {\n\n  if (typeof actionResult === 'function') {\n    actionResult(_state, dispatchHandler);\n  }\n\n  if (Object.prototype.toString.call(actionResult) === \"[object Object]\") {\n\n    if (typeof actionResult.type !== 'string')\n        throw new Error('Type is required and expect \"string\"');\n    _dispatch(actionResult);\n  }\n}\n\nfunction actionsWrapper(action) {\n\n  return (...args) => {\n\n    const actionResult = action(...args);\n\n    dispatchHandler(actionResult);\n  }\n}\n\n\nfunction actionsHandler(actions) {\n  if (!actions) \n    return;\n\n  const _action = Object.create(null);\n\n  for (const name in actions) {\n    if (actions.hasOwnProperty(name)) {\n      \n      _action[name] = actionsWrapper(actions[name]);\n    }\n  }\n\n  return _action;\n}\n\n\nexport default function Connect(\n  component,\n  reducerName,\n  actions,\n  actionName\n) {\n\n    return function (props) {\n\n      const [state, dispatch] = useContext(HooksContext);\n\n      _state = state;\n\n      _dispatch = dispatch;\n\n      const _props = {\n          ...props,\n          [reducerName]: [state, dispatch]\n      }\n\n      if (actionName)\n          _props[actionName] = actionsHandler(actions);\n\n      return React.createElement(\n        component,\n        _props\n      )\n    }\n}\n","\nfunction compose(...functions) {\n\n  if (Array.isArray(functions) && functions.length > 1)\n        return functions.reduce(\n            (fn, nextFn) =>\n                    (...args) =>\n                        nextFn(fn(...args)));\n\n  if (Array.isArray(functions) && functions.length === 1)\n        return functions[0];\n  \n  return () => new Error('compose 函数接收的参数错误')\n}\n\nconst store = {};\n\nfunction reducersWrapper(reducers) {\n  return reducers.map(({key, reducer, done}) => {\n    return (state, action) => {\n\n      if (Array.isArray(state) && !action)\n          [state, action] = state;\n      \n      store[key] = reducer(state[key], action) || Object.create(null);\n\n      if (done)\n        return {...store};\n\n      return [state, action];\n    }\n  })\n}\n\n\nfunction mergeReducer(mergedReducer) {\n\n  const reducersKeys = Object.keys(mergedReducer);\n  const reducers = reducersKeys.map((key, i, arr) => {\n      return {\n        key: key,\n        reducer: mergedReducer[key],\n        done: (i+1) === arr.length\n      }\n  })\n\n  return compose(...reducersWrapper(reducers));\n}\n\n\nexport default mergeReducer;"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","initStore","_state","_dispatch","HooksContext","React","createContext","initState","create","initAction","dispatchHandler","actionResult","toString","type","Error","actionsWrapper","action","compose","functions","Array","isArray","reduce","fn","nextFn","store","props","hooksStore","useReducer","state","dispatch","_children","children","_props","createElement","Provider","value","cloneElement","component","reducerName","actions","actionName","useContext","_action","name","actionsHandler","mergedReducer","reducers","keys","map","arr","reducer","done","reducersWrapper"],"mappings":"uTAAe,SAASA,IAetB,OAdAA,EAAWC,OAAOC,QAAU,SAAUC,GACpC,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CACzC,IAAIG,EAASF,UAAUD,GAEvB,IAAK,IAAII,KAAOD,EACVN,OAAOQ,UAAUC,eAAeC,KAAKJ,EAAQC,KAC/CL,EAAOK,GAAOD,EAAOC,IAK3B,OAAOL,IAGOS,MAAMC,KAAMR,WCbvB,IAIHS,ECHAC,EAAQC,EDDCC,EAAeC,EAAMC,cAAc,MAE1CC,EAAYnB,OAAOoB,OAAO,MAC1BC,EAAarB,OAAOoB,OAAO,MCAjC,IAAME,EAAkB,SAAlBA,EAAmBC,MAEK,mBAAjBA,GACTA,EAAaT,EAAQQ,GAG8B,oBAAjDtB,OAAOQ,UAAUgB,SAASd,KAAKa,GAAqC,IAErC,iBAAtBA,EAAaE,KACpB,MAAM,IAAIC,MAAM,wCACpBX,EAAUQ,KAId,SAASI,EAAeC,UAEf,eAECL,EAAeK,0BAErBN,EAAgBC,ICxBpB,SAASM,+BAAWC,2BAAAA,yBAEdC,MAAMC,QAAQF,IAAcA,EAAUzB,OAAS,EACtCyB,EAAUG,QACb,SAACC,EAAIC,UACG,kBACIA,EAAOD,+BAEzBH,MAAMC,QAAQF,IAAmC,IAArBA,EAAUzB,OAC7ByB,EAAU,GAEhB,kBAAM,IAAIJ,MAAM,sBAGzB,IAAMU,EAAQ,mBFPC,SAAuBC,GAE7BxB,IACDA,EAAYwB,EAAMC,WAAWnB,EAAWE,UAElBkB,aACtBF,EAAMC,WACNzB,GAFG2B,OAAOC,OAKRC,EAAYL,EAAMM,SAClBC,EAAS,OAEV,IAAMrC,KAAO8B,EACVA,EAAM5B,eAAeF,IACT,aAARA,IACAqC,EAAOrC,GAAO8B,EAAM9B,WAKzBU,EAAM4B,cACT7B,EAAa8B,SACb,CAACC,MAAO,CAACP,EAAOC,IAChBxB,EAAM+B,aAAaN,EAAWE,eCevB,SACbK,EACAC,EACAC,EACAC,UAGS,SAAUf,WAEWgB,aAAWrC,GAA9BwB,OAAOC,OAEd3B,EAAS0B,EAETzB,EAAY0B,MAENG,OACCP,UACFa,GAAc,CAACV,EAAOC,cAGvBW,IACAR,EAAOQ,GAtCjB,SAAwBD,MACjBA,OAGCG,EAAUtD,OAAOoB,OAAO,UAEzB,IAAMmC,KAAQJ,EACbA,EAAQ1C,eAAe8C,KAEzBD,EAAQC,GAAQ5B,EAAewB,EAAQI,YAIpCD,GAyBsBE,CAAeL,IAEjClC,EAAM4B,cACXI,EACAL,oBCrCR,SAAsBa,OAGdC,EADe1D,OAAO2D,KAAKF,GACHG,KAAI,SAACrD,EAAKJ,EAAG0D,SAChC,CACLtD,IAAKA,EACLuD,QAASL,EAAclD,GACvBwD,KAAO5D,EAAE,IAAO0D,EAAIxD,kBAInBwB,eA7BT,SAAyB6B,UAChBA,EAASE,KAAI,gBAAErD,IAAAA,IAAKuD,IAAAA,QAASC,IAAAA,YAC3B,SAACvB,EAAOZ,MAETG,MAAMC,QAAQQ,KAAWZ,SACPY,EAAjBA,OAAOZ,cAEZQ,EAAM7B,GAAOuD,EAAQtB,EAAMjC,GAAMqB,IAAW5B,OAAOoB,OAAO,MAEtD2C,OACS3B,GAEN,CAACI,EAAOZ,OAiBDoC,CAAgBN"}