{"version":3,"file":"hooks-reducer.min.js","sources":["../node_modules/@babel/runtime/helpers/esm/extends.js","../src/provider.js","../src/connect.js","../src/mergeReducer.js"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import React, {useReducer} from 'react';\n\n\nexport const HooksContext = React.createContext(null);\n\n\nconst initialState = {};\n\nexport default function HooksProvider(props) {\n    const [state, dispatch] = useReducer(\n        props.hooksStore,\n        initialState\n    );\n\n    return React.createElement(\n        HooksContext.Provider,\n        {value: [state, dispatch]},\n        React.cloneElement(\n          props.children,\n          props\n        )\n    )\n}\n\n","import React, {useContext} from 'react';\nimport {HooksContext} from './provider';\n\nlet _state, _dispatch;\n\nconst dispatchWrapper = (action) => {\n\n  if (typeof action === 'function') {\n    action(_state, dispatchWrapper);\n  }\n\n  if (Object.prototype.toString.call(action) === \"[object Object]\") {\n\n    if (typeof action.type !== 'string')\n        throw new Error('Type is required and expect \"string\"');\n    _dispatch(action);\n  }\n}\n\nfunction actionsWrapper(action) {\n\n  return (...args) => {\n\n    const result = action(...args);\n\n    if (typeof result === 'function') {\n      result(_state, dispatchWrapper);\n    }\n\n    if (Object.prototype.toString.call(result) === \"[object Object]\") {\n\n      if (typeof result.type !== 'string')\n          throw new Error('Type is required and expect \"string\"');\n      _dispatch(result);\n    }\n  }\n}\n\n\nfunction actionsHandler(actions) {\n  if (!actions) \n    return;\n\n  const _action = Object.create(null);\n\n  for (const name in actions) {\n    if (actions.hasOwnProperty(name)) {\n      \n      _action[name] = actionsWrapper(actions[name]);\n    }\n  }\n\n  return _action;\n}\n\n\nexport default function Connect(\n  component,\n  reducerName,\n  actions,\n  actionName\n) {\n\n    return function (props) {\n\n      const [state, dispatch] = useContext(HooksContext);\n\n      _state = state;\n\n      _dispatch = dispatch;\n\n      const enhancedActions = actionsHandler(actions);\n\n      const _props = {\n          ...props,\n          [reducerName]: [state, dispatch]\n      }\n\n      if (actionName) {\n        _props[actionName] = enhancedActions;\n      }\n\n      return React.createElement(\n        component,\n        _props\n      )\n    }\n}\n","function reducerWrapper(reducer, state, action, done = false) {\n\n  if (typeof reducer.value.done === 'undefined')\n    reducer.value.done = done;\n\n  if (typeof reducer.value.done === 'boolean')\n    done = reducer.value.done;\n\n  if (!action && done)\n    return state;\n\n  if (!action)\n    return [state, null];\n\n  let result;\n\n  try {\n    result = reducer.value(state, action);\n  } catch (error) {\n\n  }\n\n  if (result && done) {\n    return {...state, [reducer.key]: result};\n  } else if (result) {\n    return [{...state, [reducer.key]: result}, null];\n  } else if (done) {\n    throw new Error('Reducer hooks can`t found matched \"type\".');\n  } else {\n    return [state, action];\n  }\n}\n\n\nfunction compose(...functions) {\n\n  if (Array.isArray(functions) && functions.length > 0) {\n\n        return functions.reduce((res, fn, i) => (...args) => {\n            const _res = res(...args);\n\n            if (Array.isArray(_res))\n                return fn(..._res, functions.length-1 === i)\n            else\n                return fn(_res)\n        }\n    )\n  }\n  if (Array.isArray(functions) && functions.length === 1) {\n    return functions[0]\n  }\n  return () => new Error('compose 函数接收的参数错误')\n}\n\n\n\nfunction mergeReducer(mergedReducer) {\n  const reducerWrappers = [];\n\n  for (const key in mergedReducer) {\n    if (mergedReducer.hasOwnProperty(key)) {\n      reducerWrappers.push(\n        reducerWrapper.bind(this, {key: key, value: mergedReducer[key]})\n      );\n    }\n  }\n\n  return compose(...reducerWrappers);\n}\n\n\nexport default mergeReducer;\n\n\n/* mock data */\n\n/*\nfunction reducer1(state, action) {\n  switch (action.type) {\n    case 'increment':\n      return {count: state.count + 1};\n    case 'decrement':\n      return {count: state.count - 1};\n    default:\n      throw new Error();\n  }\n}\n\nfunction reducer2(state, action) {\n    switch (action.type) {\n      case 'increment2':\n        return {count: 100};\n      case 'decrement3':\n        return {count: 200};\n      default:\n        throw new Error();\n    }\n}\n\nconst _mockresult = {\n  reducer1,\n  reducer2\n}\n\n// mergeReducer(_mockresult);\n\n*/\n"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","_state","_dispatch","HooksContext","React","createContext","initialState","dispatchWrapper","action","toString","type","Error","actionsWrapper","result","reducerWrapper","reducer","state","done","value","error","compose","functions","Array","isArray","reduce","res","fn","_res","props","useReducer","hooksStore","dispatch","createElement","Provider","cloneElement","children","component","reducerName","actions","actionName","useContext","enhancedActions","_action","create","name","actionsHandler","_props","mergedReducer","reducerWrappers","push","bind"],"mappings":"uTAAe,SAASA,IAetB,OAdAA,EAAWC,OAAOC,QAAU,SAAUC,GACpC,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CACzC,IAAIG,EAASF,UAAUD,GAEvB,IAAK,IAAII,KAAOD,EACVN,OAAOQ,UAAUC,eAAeC,KAAKJ,EAAQC,KAC/CL,EAAOK,GAAOD,EAAOC,IAK3B,OAAOL,IAGOS,MAAMC,KAAMR,WCZvB,ICAHS,EAAQC,EDACC,EAAeC,EAAMC,cAAc,MAG1CC,EAAe,GCDrB,IAAMC,EAAkB,SAAlBA,EAAmBC,MAED,mBAAXA,GACTA,EAAOP,EAAQM,GAG8B,oBAA3CnB,OAAOQ,UAAUa,SAASX,KAAKU,GAA+B,IAErC,iBAAhBA,EAAOE,KACd,MAAM,IAAIC,MAAM,wCACpBT,EAAUM,KAId,SAASI,EAAeJ,UAEf,eAECK,EAASL,6BAEO,mBAAXK,GACTA,EAAOZ,EAAQM,GAG8B,oBAA3CnB,OAAOQ,UAAUa,SAASX,KAAKe,GAA+B,IAErC,iBAAhBA,EAAOH,KACd,MAAM,IAAIC,MAAM,wCACpBT,EAAUW,KCjChB,SAASC,EAAeC,EAASC,EAAOR,EAAQS,eAAAA,IAAAA,GAAO,QAEnB,IAAvBF,EAAQG,MAAMD,OACvBF,EAAQG,MAAMD,KAAOA,GAEW,kBAAvBF,EAAQG,MAAMD,OACvBA,EAAOF,EAAQG,MAAMD,OAElBT,GAAUS,EACb,OAAOD,MAEJR,EACH,MAAO,CAACQ,EAAO,UAEbH,UAGFA,EAASE,EAAQG,MAAMF,EAAOR,GAC9B,MAAOW,OAILN,GAAUI,cACDD,UAAQD,EAAQpB,KAAMkB,MAC5B,GAAIA,QACF,MAAKG,UAAQD,EAAQpB,KAAMkB,MAAS,MACtC,GAAII,QACH,IAAIN,MAAM,mDAET,CAACK,EAAOR,GAKnB,SAASY,+BAAWC,2BAAAA,yBAEdC,MAAMC,QAAQF,IAAcA,EAAU5B,OAAS,EAEtC4B,EAAUG,QAAO,SAACC,EAAKC,EAAInC,UAAM,eAC9BoC,EAAOF,iCAETH,MAAMC,QAAQI,GACPD,eAAMC,UAAMN,EAAU5B,OAAO,IAAMF,KAEnCmC,EAAGC,OAIpBL,MAAMC,QAAQF,IAAmC,IAArBA,EAAU5B,OACjC4B,EAAU,GAEZ,kBAAM,IAAIV,MAAM,sCF3CV,SAAuBiB,SACRC,aACtBD,EAAME,WACNxB,GAFGU,OAAOe,cAKP3B,EAAM4B,cACT7B,EAAa8B,SACb,CAACf,MAAO,CAACF,EAAOe,IAChB3B,EAAM8B,aACJN,EAAMO,SACNP,eCqCK,SACbQ,EACAC,EACAC,EACAC,UAGS,SAAUX,WAEWY,aAAWrC,GAA9Ba,OAAOe,OAEd9B,EAASe,EAETd,EAAY6B,MAENU,EAhCZ,SAAwBH,MACjBA,OAGCI,EAAUtD,OAAOuD,OAAO,UAEzB,IAAMC,KAAQN,EACbA,EAAQzC,eAAe+C,KAEzBF,EAAQE,GAAQhC,EAAe0B,EAAQM,YAIpCF,GAmBqBG,CAAeP,GAEjCQ,OACClB,UACFS,GAAc,CAACrB,EAAOe,cAGvBQ,IACFO,EAAOP,GAAcE,GAGhBrC,EAAM4B,cACXI,EACAU,oBC5BR,SAAsBC,OACdC,EAAkB,OAEnB,IAAMrD,KAAOoD,EACZA,EAAclD,eAAeF,IAC/BqD,EAAgBC,KACdnC,EAAeoC,KAAKlD,KAAM,CAACL,IAAKA,EAAKuB,MAAO6B,EAAcpD,aAKzDyB,eAAW4B"}