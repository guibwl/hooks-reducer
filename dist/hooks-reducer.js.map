{"version":3,"file":"hooks-reducer.js","sources":["../node_modules/@babel/runtime/helpers/esm/extends.js","../src/provider.js","../src/connect.js","../src/mergeReducer.js"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import React, {useReducer} from 'react';\n\nexport const HooksContext = React.createContext(null);\n\nconst initState = Object.create(null);\nconst initAction = Object.create(null);\nlet initStore;\n\nexport default function HooksProvider(props) {\n\n    if (!initStore)\n        initStore = props.hooksStore(initState, initAction);\n\n    const [state, dispatch] = useReducer(\n        props.hooksStore,\n        initStore\n    );\n\n    const _children = props.children;\n    const _props = {};\n\n    for (const key in props) {\n        if (props.hasOwnProperty(key)) {\n            if (key !== 'children') {\n                _props[key] = props[key];\n            }\n        }\n    }\n\n    return React.createElement(\n        HooksContext.Provider,\n        {value: [state, dispatch]},\n        React.cloneElement(_children, _props)\n    )\n}\n\n","import React, {useContext} from 'react';\nimport {HooksContext} from './provider';\n\nlet _state, _dispatch;\n\nconst dispatchHandler = (actionResult) => {\n\n  if (typeof actionResult === 'function') {\n    actionResult(_state, dispatchHandler);\n  }\n\n  if (Object.prototype.toString.call(actionResult) === \"[object Object]\") {\n\n    if (typeof actionResult.type !== 'string')\n        throw new Error('Type is required and expect \"string\"');\n    _dispatch(actionResult);\n  }\n}\n\nfunction actionsWrapper(action) {\n\n  return (...args) => {\n\n    const actionResult = action(...args);\n\n    dispatchHandler(actionResult);\n  }\n}\n\n\nfunction actionsHandler(actions) {\n  if (!actions) \n    return;\n\n  const _action = Object.create(null);\n\n  for (const name in actions) {\n    if (actions.hasOwnProperty(name)) {\n      \n      _action[name] = actionsWrapper(actions[name]);\n    }\n  }\n\n  return _action;\n}\n\n\nexport default function Connect(\n  component,\n  reducerName,\n  actions,\n  actionName\n) {\n\n    return function (props) {\n\n      const [state, dispatch] = useContext(HooksContext);\n\n      _state = state;\n\n      _dispatch = dispatch;\n\n      const _props = {\n          ...props,\n          [reducerName]: [state, dispatch]\n      }\n\n      if (actionName)\n          _props[actionName] = actionsHandler(actions);\n\n      return React.createElement(\n        component,\n        _props\n      )\n    }\n}\n","\nfunction compose(...functions) {\n\n  if (Array.isArray(functions) && functions.length > 1)\n        return functions.reduce(\n            (fn, nextFn) =>\n                    (...args) =>\n                        nextFn(fn(...args)));\n\n  if (Array.isArray(functions) && functions.length === 1)\n        return functions[0];\n  \n  return () => new Error('compose 函数接收的参数错误')\n}\n\nconst store = {};\n\nfunction reducersWrapper(reducers) {\n  return reducers.map(({key, reducer, done}) => {\n    return (state, action) => {\n\n      if (Array.isArray(state) && !action)\n          [state, action] = state;\n      \n      store[key] = reducer(state[key], action) || Object.create(null);\n\n      if (done)\n        return {...store};\n\n      return [state, action];\n    }\n  })\n}\n\n\nfunction mergeReducer(mergedReducer) {\n\n  const reducersKeys = Object.keys(mergedReducer);\n  const reducers = reducersKeys.map((key, i, arr) => {\n      return {\n        key: key,\n        reducer: mergedReducer[key],\n        done: (i+1) === arr.length\n      }\n  })\n\n  return compose(...reducersWrapper(reducers));\n}\n\n\nexport default mergeReducer;"],"names":["HooksContext","React","createContext","initState","Object","create","initAction","initStore","HooksProvider","props","hooksStore","useReducer","state","dispatch","_children","children","_props","key","hasOwnProperty","createElement","Provider","value","cloneElement","_state","_dispatch","dispatchHandler","actionResult","prototype","toString","call","type","Error","actionsWrapper","action","actionsHandler","actions","_action","name","Connect","component","reducerName","actionName","useContext","compose","functions","Array","isArray","length","reduce","fn","nextFn","store","reducersWrapper","reducers","map","reducer","done","mergeReducer","mergedReducer","reducersKeys","keys","i","arr"],"mappings":"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"}