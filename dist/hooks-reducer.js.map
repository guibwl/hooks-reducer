{"version":3,"file":"hooks-reducer.js","sources":["../node_modules/@babel/runtime/helpers/esm/extends.js","../src/provider.js","../src/connect.js","../src/mergeReducer.js"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import React, {useReducer} from 'react';\n\n\nexport const HooksContext = React.createContext(null);\n\n\nconst initialState = {};\n\nexport default function HooksProvider(props) {\n    const [state, dispatch] = useReducer(\n        props.hooksStore,\n        initialState\n    );\n\n    return React.createElement(\n        HooksContext.Provider,\n        {value: [state, dispatch]},\n        React.cloneElement(\n          props.children,\n          props\n        )\n    )\n}\n\n","import React, {useContext} from 'react';\nimport {HooksContext} from './provider';\n\nlet _state, _dispatch;\n\nconst dispatchWrapper = (action) => {\n\n  if (typeof action === 'function') {\n    action(_state, dispatchWrapper);\n  }\n\n  if (Object.prototype.toString.call(action) === \"[object Object]\") {\n\n    if (typeof action.type !== 'string')\n        throw new Error('Type is required and expect \"string\"');\n    _dispatch(action);\n  }\n}\n\nfunction actionsWrapper(action) {\n\n  return (...args) => {\n\n    const result = action(...args);\n\n    if (typeof result === 'function') {\n      result(_state, dispatchWrapper);\n    }\n\n    if (Object.prototype.toString.call(result) === \"[object Object]\") {\n\n      if (typeof result.type !== 'string')\n          throw new Error('Type is required and expect \"string\"');\n      _dispatch(result);\n    }\n  }\n}\n\n\nfunction actionsHandler(actions) {\n  if (!actions) \n    return;\n\n  const _action = Object.create(null);\n\n  for (const name in actions) {\n    if (actions.hasOwnProperty(name)) {\n      \n      _action[name] = actionsWrapper(actions[name]);\n    }\n  }\n\n  return _action;\n}\n\n\nexport default function Connect(\n  component,\n  reducerName,\n  actions,\n  actionName\n) {\n\n    return function (props) {\n\n      const [state, dispatch] = useContext(HooksContext);\n\n      _state = state;\n\n      _dispatch = dispatch;\n\n      const enhancedActions = actionsHandler(actions);\n\n      const _props = {\n          ...props,\n          [reducerName]: [state, dispatch]\n      }\n\n      if (actionName) {\n        _props[actionName] = enhancedActions;\n      }\n\n      return React.createElement(\n        component,\n        _props\n      )\n    }\n}\n","function reducerWrapper(reducer, state, action, done = false) {\n\n  if (typeof reducer.value.done === 'undefined')\n    reducer.value.done = done;\n\n  if (typeof reducer.value.done === 'boolean')\n    done = reducer.value.done;\n\n  if (!action && done)\n    return state;\n\n  if (!action)\n    return [state, null];\n\n  let result;\n\n  try {\n    result = reducer.value(state, action);\n  } catch (error) {\n\n  }\n\n  if (result && done) {\n    return {...state, [reducer.key]: result};\n  } else if (result) {\n    return [{...state, [reducer.key]: result}, null];\n  } else if (done) {\n    throw new Error('Reducer hooks can`t found matched \"type\".');\n  } else {\n    return [state, action];\n  }\n}\n\n\nfunction compose(...functions) {\n\n  if (Array.isArray(functions) && functions.length > 0) {\n\n        return functions.reduce((res, fn, i) => (...args) => {\n            const _res = res(...args);\n\n            if (Array.isArray(_res))\n                return fn(..._res, functions.length-1 === i)\n            else\n                return fn(_res)\n        }\n    )\n  }\n  if (Array.isArray(functions) && functions.length === 1) {\n    return functions[0]\n  }\n  return () => new Error('compose 函数接收的参数错误')\n}\n\n\n\nfunction mergeReducer(mergedReducer) {\n  const reducerWrappers = [];\n\n  for (const key in mergedReducer) {\n    if (mergedReducer.hasOwnProperty(key)) {\n      reducerWrappers.push(\n        reducerWrapper.bind(this, {key: key, value: mergedReducer[key]})\n      );\n    }\n  }\n\n  return compose(...reducerWrappers);\n}\n\n\nexport default mergeReducer;\n\n\n/* mock data */\n\n/*\nfunction reducer1(state, action) {\n  switch (action.type) {\n    case 'increment':\n      return {count: state.count + 1};\n    case 'decrement':\n      return {count: state.count - 1};\n    default:\n      throw new Error();\n  }\n}\n\nfunction reducer2(state, action) {\n    switch (action.type) {\n      case 'increment2':\n        return {count: 100};\n      case 'decrement3':\n        return {count: 200};\n      default:\n        throw new Error();\n    }\n}\n\nconst _mockresult = {\n  reducer1,\n  reducer2\n}\n\n// mergeReducer(_mockresult);\n\n*/\n"],"names":["HooksContext","React","createContext","initialState","HooksProvider","props","useReducer","hooksStore","state","dispatch","createElement","Provider","value","cloneElement","children","_state","_dispatch","dispatchWrapper","action","Object","prototype","toString","call","type","Error","actionsWrapper","result","actionsHandler","actions","_action","create","name","hasOwnProperty","Connect","component","reducerName","actionName","useContext","enhancedActions","_props","reducerWrapper","reducer","done","error","key","compose","functions","Array","isArray","length","reduce","res","fn","i","_res","mergeReducer","mergedReducer","reducerWrappers","push","bind"],"mappings":"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"}